# 1 Deactivate any active venv (ignore errors)
deactivate 2>/dev/null

# 2 Remove old venv and stray config
rm -rf .venv
rm -f pyvenv.cfg

# 3 Update system packages and install PyQt5
sudo apt update
sudo apt install -y python3-pyqt5 python3-pip python3-dev

# 4 Create a new venv with access to system packages
python3 -m venv .venv --system-site-packages

# 5 Activate the venv
. .venv/bin/activate

# 6 Upgrade pip inside the venv
pip install --upgrade pip

# 7 Install all pip packages from requirements.txt
pip install -r requirements.txt

# 8 Verify basic imports (optional, sanity check)
python -c "from PyQt5 import QtWidgets; import numpy; import cv2; import pyqtgraph; from adafruit_servokit import ServoKit; import adafruit_pca9685; import picamera2; print('All imports OK')"
